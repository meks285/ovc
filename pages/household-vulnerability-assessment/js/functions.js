document.addEventListener('DOMContentLoaded', init);

function init(){
    
 
//Activate SubmitForm function to validate and submit form to DB
    document.getElementById("buttonSubmit").addEventListener('click',submitForm,false);

    //Add CBO Code as Prefix to HH unique number
    document.getElementById("cbo_code").addEventListener('change',function(ev){
        if(ev.target.value){
            cbo_code_addon = ev.target.value;
            if(cbo_code_addon == cbo_code_compare){
                state_addon = document.getElementById("state").value;
                lga_addon = document.getElementById("lga").value;
                $.ajax({
                    url: 'db/getAddon.php',
                    type: 'post',
                    data: "state_addon="+state_addon+"&lga_addon="+lga_addon,  
                    dataType: 'json',
                    success: function(response){ 
                      if(response.status=="success"){
                            document.getElementById("addoncbo").innerHTML = response.addon+cbo_code_addon+'/';  
                            //console.log(document.getElementById("addoncbo").innerHTML);
                        }
                        },
                error: function(XMLHttpRequest, textStatus, errorThrown) { 
                    alert("Status: " + textStatus); alert("Error: " + errorThrown+XMLHttpRequest); 
                }  	
              });             

            }
            else{
                const toast = Toastify({
                    text: "CBO Code must match your login CBO",
                    style: {
                      background: "linear-gradient(to right, #DC3545, #DC3545)",
                    },
                    close: true,
                    duration: 3000
                });    
                toast.showToast();   
                document.getElementById("cbo_code").value = "";      
            }
            
        }
    },false);
    
//Change HHUnique ID once LGA changes
    document.getElementById("lga").addEventListener('change',function(ev){

        if(document.getElementById("cbo_code").value && (document.getElementById("cbo_code").value !='Select CBO Code')){
            console.log("CBO Value: "+document.getElementById("cbo_code").value);
//            cbo_code_addon = document.getElementById("cbo_code").value;
            if(cbo_code_addon == cbo_code_compare){
                state_addon = document.getElementById("state").value;
                lga_addon = document.getElementById("lga").value;
                $.ajax({
                    url: 'db/getAddon.php',
                    type: 'post',
                    data: "state_addon="+state_addon+"&lga_addon="+lga_addon,  
                    dataType: 'json',
                    success: function(response){ 
                      if(response.status=="success"){
                            document.getElementById("addoncbo").innerHTML = response.addon+cbo_code_addon+'/';            
                        }
                        },
                error: function(XMLHttpRequest, textStatus, errorThrown) { 
                    alert("Status: " + textStatus); alert("Error: " + errorThrown+XMLHttpRequest); 
                }  	
              });             

            }
            else{
                const toast = Toastify({
                    text: "CBO Code must match your login CBO",
                    style: {
                      background: "linear-gradient(to right, #DC3545, #DC3545)",
                    },
                    close: true,
                    duration: 3000
                });    
                toast.showToast();   
                document.getElementById("cbo_code").value = "";      
            }
            
        }
    },false);

    //Validate that Number of People in House hold is greater than number of children.    
    document.getElementById("hh_num_people").addEventListener('change',function(){
            var hh_num_people = document.getElementById("hh_num_people").value;
            var hh_num_children = document.getElementById("hh_num_children").value;
    const toast = Toastify({
        text: "Number of Children cannot be greater or equal to number of people in Household",
        style: {
          background: "linear-gradient(to right, #DC3545, #DC3545)",
        },
        close: true,
        duration: 3000
    });  
            if(hh_num_children >= hh_num_people){

                toast.showToast();    
                document.getElementById("hh_num_people").value="";         
            }
            else{           
                //toast.destroy();
            }

    },false)

// Validate that Date of Birth of caregiver is above 17 years  
    document.getElementById("dob").addEventListener('change',function(){

//Initialize Toast
const caregiverAgeToast = Toastify({
    text: "Primary Caregiver cannot be a minor (<= 17 years)",
    style: {
      background: "linear-gradient(to right, #DC3545, #DC3545)",
    },
    close: true,
    duration: 3000
});         
        dob_value = new Date(document.getElementById("dob").value);
        dob_year = dob_value.getFullYear();
        //Get Todays Date
        const today = new Date();
        const current_year = today.getFullYear();
        age = current_year-dob_year;
        if(age <= 12){
            caregiverAgeToast.showToast();
            document.getElementById("dob").value = "";
        }
    }, false)

//Add response out to total Yes/No/N/A
// STEP - 1: Create an Array
// STEP - 2: Add all response elements to the Array
// STEP - 3: Get their values and populate the action elements
                  
document.getElementById("hh_ass_healthy_response_question_1").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

//    console.log('Yes: '+getOccurrence(response,'Yes')+'. No: '+getOccurrence(response,'No')+'. '+'NA: '+getOccurrence(response,'N/A')); 

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');

},false)
document.getElementById("hh_ass_healthy_response_question_2").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_healthy_response_question_3").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_healthy_response_question_4").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_healthy_response_question_5").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_healthy_response_question_6").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_safe_response_question_7").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_safe_response_question_8").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_safe_response_question_9").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_schooled_response_question_10").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_stable_response_question_12").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)
document.getElementById("hh_ass_stable_response_question_13").addEventListener('change',function(){
    const response = [document.getElementById("hh_ass_healthy_response_question_1").value, 
                  document.getElementById("hh_ass_healthy_response_question_2").value,
                  document.getElementById("hh_ass_healthy_response_question_3").value,
                  document.getElementById("hh_ass_healthy_response_question_4").value,
                  document.getElementById("hh_ass_healthy_response_question_5").value,
                  document.getElementById("hh_ass_healthy_response_question_6").value,
                  document.getElementById("hh_ass_safe_response_question_7").value,
                  document.getElementById("hh_ass_safe_response_question_8").value,
                  document.getElementById("hh_ass_safe_response_question_9").value,
                  document.getElementById("hh_ass_schooled_response_question_10").value,
                  document.getElementById("hh_ass_stable_response_question_12").value,
                  document.getElementById("hh_ass_stable_response_question_13").value];

    document.getElementById("total_yes").value =  getOccurrence(response,'Yes');
    document.getElementById("total_no").value =  getOccurrence(response,'No');
    document.getElementById("total_na").value =  getOccurrence(response,'N/A');
},false)


//START
//Hide HIV Status DIVs on Launch. Show only when HIV Status is Positive.
//START

document.getElementById("div_datehivstatus").style.display = 'none';
document.getElementById("div_enrolledontreatment").style.display = 'none';
document.getElementById("div_artstartdate").style.display = 'none';
document.getElementById("div_facilityenrolled").style.display = 'none';
document.getElementById("div_treatment_art_no").style.display = 'none';

document.getElementById("hiv_status").addEventListener('change',function(ev){
    if(ev.target.value=='Positive'){
        document.getElementById("div_datehivstatus").style.display = 'block';
        document.getElementById("div_enrolledontreatment").style.display = 'block';        
    }
    else if(ev.target.value=='Negative'){
        document.getElementById("div_datehivstatus").style.display = 'block';
        document.getElementById("div_enrolledontreatment").style.display = 'none';        
    }
    else{
        document.getElementById("div_datehivstatus").style.display = 'none';
        document.getElementById("div_enrolledontreatment").style.display = 'none';    
        document.getElementById("div_artstartdate").style.display = 'none';
        document.getElementById("div_facilityenrolled").style.display = 'none';
        document.getElementById("div_treatment_art_no").style.display = 'none';    
        
    }

}, false)

document.getElementById("enrolledontreatment").addEventListener('change',function(ev){
    if(ev.target.value=='Yes'){
        document.getElementById("div_artstartdate").style.display = 'block';
        document.getElementById("div_facilityenrolled").style.display = 'block';
        document.getElementById("div_treatment_art_no").style.display = 'block';      
    }
    else{
        document.getElementById("div_artstartdate").style.display = 'none';
        document.getElementById("div_facilityenrolled").style.display = 'none';
        document.getElementById("div_treatment_art_no").style.display = 'none';    
        
    }
}, false)
//START
//Check The treatment_art_no/pepid field for unacceptable characters
//START

document.getElementById("treatment_art_no").addEventListener('change', function(e) {
        const toast = Toastify({
        text: "Error: Treatment Number Input violates acceptable Format",
        style: {
          background: "linear-gradient(to right, #DC3545, #DC3545)",
        },
        close: true,
        duration: 3000
    });  
    //console.log('entry');
    // Get all inputs in the form we specifically are looking at, this selector can be
    // changed if this is supposed to be applied to specific inputs
    //var inputs = document.querySelectorAll('#treatment_art_no input');
    var forbiddenChars = /[^a-z\d\-]/ig;
    var alphabetChars = /[^aA-zZ]+$/g;
    var treatment_no = e.target.value;
    var totalCount = treatment_no.length;

    
        // Check that there aren't any forbidden chars
        if(forbiddenChars.test(treatment_no) || alphabetChars.test(treatment_no.slice(0, 2)) || (totalCount > 11 || totalCount<10)) {
            console.log('input violates PEPID Number Format.');
            toast.showToast();
            document.getElementById("treatment_art_no").value='';
            //return false;
        }
        else{
                      
        }

}, false);

//Check if User has rights to Data Entry, IF no, Disable the HHVA Form
if(!privilege.includes("Data Entry")){
    document.getElementById("buttonSubmit").disabled = true;
    document.getElementById("buttonSubmit").style.backgroundColor = 'gray';
    document.getElementById("buttonSubmit").innerText = 'disabled';
        Toastify({
            text: "User does not have the rights to access this form template.",
            style: {
              background: "linear-gradient(to right, #DC3545, #DC3545)",
            },
            close: true,
            duration: 10000
        }).showToast();    
}


}
//Find how many times the responses appear in the array RESPONSE
function getOccurrence(array, value) {
    var count = 0;
    array.forEach((v) => (v === value && count++));
    return count;
}

//Function to submit Form
function submitForm(ev){
    ev.preventDefault();

    //cbo_name = document.getElementById("cbo_name").value;
    //cbo_details = document.getElementById("cbo_details").value;

    cbo_code = document.getElementById("cbo_code").value;
    date_of_assessment = document.getElementById("date_of_assessment").value;
    state = document.getElementById("state").value;
    lga = document.getElementById("lga").value;
    ward = document.getElementById("ward").value;
    community = document.getElementById("community").value;
    hh_unique_num = document.getElementById("hh_unique_num").value;
    addon = document.getElementById("addoncbo").innerHTML;
    address = document.getElementById("address").value;
    latitude = document.getElementById("latitude").value;
    longitude = document.getElementById("longitude").value;
    hh_num_children = document.getElementById("hh_num_children").value;
    hh_num_people = document.getElementById("hh_num_people").value;

    surname = document.getElementById("surname").value;
    firstname = document.getElementById("firstname").value;
    gender = document.getElementById("gender").value;
    dob = document.getElementById("dob").value;
    phonenumber = document.getElementById("phonenumber").value;
    nin = document.getElementById("nin").value;
    marital_status = document.getElementById("marital_status").value;
    occupation = document.getElementById("occupation").value;
    hiv_status = document.getElementById("hiv_status").value;
//HIV STATUS
    datehivstatus = document.getElementById("datehivstatus").value;
    enrolledontreatment = document.getElementById("enrolledontreatment").value;
    artstartdate = document.getElementById("artstartdate").value;
    facilityenrolled = document.getElementById("facilityenrolled").value;
    treatment_art_no = document.getElementById("treatment_art_no").value;
//RESPONSE
    hh_ass_healthy_response_question_1 = document.getElementById("hh_ass_healthy_response_question_1").value;
    hh_ass_healthy_response_question_2 = document.getElementById("hh_ass_healthy_response_question_2").value;
    hh_ass_healthy_response_question_3 = document.getElementById("hh_ass_healthy_response_question_3").value;
    hh_ass_healthy_response_question_4 = document.getElementById("hh_ass_healthy_response_question_4").value;
    hh_ass_healthy_response_question_5 = document.getElementById("hh_ass_healthy_response_question_5").value;
    hh_ass_healthy_response_question_6 = document.getElementById("hh_ass_healthy_response_question_6").value;
    hh_ass_safe_response_question_7 = document.getElementById("hh_ass_safe_response_question_7").value;
    hh_ass_safe_response_question_8 = document.getElementById("hh_ass_safe_response_question_8").value;
    hh_ass_safe_response_question_9 = document.getElementById("hh_ass_safe_response_question_9").value;
    hh_ass_schooled_response_question_10 = document.getElementById("hh_ass_schooled_response_question_10").value;
    hh_ass_stable_response_question_12 = document.getElementById("hh_ass_stable_response_question_12").value;
    hh_ass_stable_response_question_13 = document.getElementById("hh_ass_stable_response_question_13").value;
//COMMENTS
hh_ass_healthy_comment_question_1 = document.getElementById("hh_ass_healthy_comment_question_1").value;
hh_ass_healthy_comment_question_2 = document.getElementById("hh_ass_healthy_comment_question_2").value;
hh_ass_healthy_comment_question_3 = document.getElementById("hh_ass_healthy_comment_question_3").value;
hh_ass_healthy_comment_question_4 = document.getElementById("hh_ass_healthy_comment_question_4").value;
hh_ass_healthy_comment_question_5 = document.getElementById("hh_ass_healthy_comment_question_5").value;
hh_ass_healthy_comment_question_6 = document.getElementById("hh_ass_healthy_comment_question_6").value;
hh_ass_safe_comment_question_7 = document.getElementById("hh_ass_safe_comment_question_7").value;
hh_ass_safe_comment_question_8 = document.getElementById("hh_ass_safe_comment_question_8").value;
hh_ass_safe_comment_question_9 = document.getElementById("hh_ass_safe_comment_question_9").value;
hh_ass_schooled_comment_question_10 = document.getElementById("hh_ass_schooled_comment_question_10").value;
hh_ass_stable_comment_question_12 = document.getElementById("hh_ass_stable_comment_question_12").value;
hh_ass_stable_comment_question_13 = document.getElementById("hh_ass_stable_comment_question_13").value;

    accessedby = document.getElementById("accessedby").value;
    reviewedby = document.getElementById("reviewedby").value;
    date_accessed = document.getElementById("date_accessed").value;
    reviewdate = document.getElementById("reviewdate").value;

    //ANALYTICS
    total_yes = document.getElementById("total_yes").value;
    total_no = document.getElementById("total_no").value;
    total_na = document.getElementById("total_na").value;

    //Create Form ID to be used to reset form elements
    entryForm = document.getElementById("entryForm");

        //Check for Validation and Missed Entries for HOUSEHOLD DETAILS Panel
        if(cbo_code=="" || cbo_code == 'Select CBO Code'){document.getElementById("cbo_code_label").innerHTML="Field is required";cbo_code_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{cbo_code_chk=1;document.getElementById("cbo_code_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(date_of_assessment==""){document.getElementById("date_of_assessment_label").innerHTML="Field is required";date_of_assessment_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{date_of_assessment_chk=1;document.getElementById("date_of_assessment_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(state=="" || state=="Select State"){document.getElementById("state_label").innerHTML="Field is required";state_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{state_chk=1;document.getElementById("state_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(lga=="" || lga=="Select LGA"){document.getElementById("lga_label").innerHTML="Field is required";lga_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{lga_chk=1;document.getElementById("lga_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(ward=="" || ward=="Select Ward"){document.getElementById("ward_label").innerHTML="Field is required";ward_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{ward_chk=1;document.getElementById("ward_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(community==""){document.getElementById("community_label").innerHTML="Field is required";community_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{community_chk=1;document.getElementById("community_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(hh_unique_num==""){document.getElementById("hh_unique_num_label").innerHTML="Field is required";hh_unique_num_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{hh_unique_num_chk=1;document.getElementById("hh_unique_num_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(address==""){document.getElementById("address_label").innerHTML="Field is required";address_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{address_chk=1;document.getElementById("address_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        // if(latitude==""){document.getElementById("latitude_label").innerHTML="Field is required";latitude_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{latitude_chk=1;document.getElementById("latitude_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        // if(longitude==""){document.getElementById("longitude_label").innerHTML="Field is required";longitude_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{longitude_chk=1;document.getElementById("longitude_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(hh_num_children==""){document.getElementById("hh_num_children_label").innerHTML="Field is required";hh_num_children_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{hh_num_children_chk=1;document.getElementById("hh_num_children_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        if(hh_num_people==""){document.getElementById("hh_num_people_label").innerHTML="Field is required";hh_num_people_chk=0;$('#collapsehouseholdDetails').collapse('show');}else{hh_num_people_chk=1;document.getElementById("hh_num_people_label").innerHTML="";$('#collapsehouseholdDetails').collapse('hide');}
        //Check for Validation and Missed Entries for PRIMARY CAREGIVER INFORMATION Panel
        if(surname==""){document.getElementById("surname_label").innerHTML="Field is required";surname_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{surname_chk=1;document.getElementById("surname_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(firstname==""){document.getElementById("firstname_label").innerHTML="Field is required";firstname_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{firstname_chk=1;document.getElementById("firstname_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(gender=="" || gender=="Select Gender"){document.getElementById("gender_label").innerHTML="Field is required";gender_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{gender_chk=1;document.getElementById("gender_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(dob==""){document.getElementById("dob_label").innerHTML="Field is required";dob_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{dob_chk=1;document.getElementById("dob_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(phonenumber==""){document.getElementById("phonenumber_label").innerHTML="Field is required";phonenumber_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{phonenumber_chk=1;document.getElementById("phonenumber_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(marital_status=="" || marital_status=="Select Marital Status"){document.getElementById("marital_status_label").innerHTML="Field is required";marital_status_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{marital_status_chk=1;document.getElementById("marital_status_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(occupation=="" || occupation=="Select Occupation"){document.getElementById("occupation_label").innerHTML="Field is required";occupation_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{occupation_chk=1;document.getElementById("occupation_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(hiv_status=="" || hiv_status=="Select HIV Status"){document.getElementById("hiv_status_label").innerHTML="Field is required";hiv_status_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{hiv_status_chk=1;document.getElementById("hiv_status_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        //Check for Validation and Missed Entries for HEALTHY (HOUSEHOLD ASSESSMENT) Panel
        if(hh_ass_healthy_response_question_1=="" || hh_ass_healthy_response_question_1=="Response"){document.getElementById("hh_ass_healthy_response_question_1_label").innerHTML="Field is required";hh_ass_healthy_response_question_1_chk=0;$('#collapseHealthyHHAssessment').collapse('show');}else{hh_ass_healthy_response_question_1_chk=1;document.getElementById("hh_ass_healthy_response_question_1_label").innerHTML="";$('#collapseHealthyHHAssessment').collapse('hide');}
        if(hh_ass_healthy_response_question_2=="" || hh_ass_healthy_response_question_2=="Response"){document.getElementById("hh_ass_healthy_response_question_2_label").innerHTML="Field is required";hh_ass_healthy_response_question_2_chk=0;$('#collapseHealthyHHAssessment').collapse('show');}else{hh_ass_healthy_response_question_2_chk=1;document.getElementById("hh_ass_healthy_response_question_2_label").innerHTML="";$('#collapseHealthyHHAssessment').collapse('hide');}
        if(hh_ass_healthy_response_question_3=="" || hh_ass_healthy_response_question_3=="Response"){document.getElementById("hh_ass_healthy_response_question_3_label").innerHTML="Field is required";hh_ass_healthy_response_question_3_chk=0;$('#collapseHealthyHHAssessment').collapse('show');}else{hh_ass_healthy_response_question_3_chk=1;document.getElementById("hh_ass_healthy_response_question_3_label").innerHTML="";$('#collapseHealthyHHAssessment').collapse('hide');}
        if(hh_ass_healthy_response_question_4=="" || hh_ass_healthy_response_question_4=="Response"){document.getElementById("hh_ass_healthy_response_question_4_label").innerHTML="Field is required";hh_ass_healthy_response_question_4_chk=0;$('#collapseHealthyHHAssessment').collapse('show');}else{hh_ass_healthy_response_question_4_chk=1;document.getElementById("hh_ass_healthy_response_question_4_label").innerHTML="";$('#collapseHealthyHHAssessment').collapse('hide');}
        if(hh_ass_healthy_response_question_5=="" || hh_ass_healthy_response_question_5=="Response"){document.getElementById("hh_ass_healthy_response_question_5_label").innerHTML="Field is required";hh_ass_healthy_response_question_5_chk=0;$('#collapseHealthyHHAssessment').collapse('show');}else{hh_ass_healthy_response_question_5_chk=1;document.getElementById("hh_ass_healthy_response_question_5_label").innerHTML="";$('#collapseHealthyHHAssessment').collapse('hide');}
        if(hh_ass_healthy_response_question_6=="" || hh_ass_healthy_response_question_6=="Response"){document.getElementById("hh_ass_healthy_response_question_6_label").innerHTML="Field is required";hh_ass_healthy_response_question_6_chk=0;$('#collapseHealthyHHAssessment').collapse('show');}else{hh_ass_healthy_response_question_6_chk=1;document.getElementById("hh_ass_healthy_response_question_6_label").innerHTML="";$('#collapseHealthyHHAssessment').collapse('hide');}
        //Check for Validation and Missed Entries for SAFE (HOUSEHOLD ASSESSMENT) Panel
        if(hh_ass_safe_response_question_7=="" || hh_ass_safe_response_question_7=="Response"){document.getElementById("hh_ass_safe_response_question_7_label").innerHTML="Field is required";hh_ass_safe_response_question_7_chk=0;$('#collapseSafeHHAssessment').collapse('show');}else{hh_ass_safe_response_question_7_chk=1;document.getElementById("hh_ass_safe_response_question_7_label").innerHTML="";$('#collapseSafeHHAssessment').collapse('hide');}
        if(hh_ass_safe_response_question_8=="" || hh_ass_safe_response_question_8=="Response"){document.getElementById("hh_ass_safe_response_question_8_label").innerHTML="Field is required";hh_ass_safe_response_question_8_chk=0;$('#collapseSafeHHAssessment').collapse('show');}else{hh_ass_safe_response_question_8_chk=1;document.getElementById("hh_ass_safe_response_question_8_label").innerHTML="";$('#collapseSafeHHAssessment').collapse('hide');}
        if(hh_ass_safe_response_question_9=="" || hh_ass_safe_response_question_9=="Response"){document.getElementById("hh_ass_safe_response_question_9_label").innerHTML="Field is required";hh_ass_safe_response_question_9_chk=0;$('#collapseSafeHHAssessment').collapse('show');}else{hh_ass_safe_response_question_9_chk=1;document.getElementById("hh_ass_safe_response_question_9_label").innerHTML="";$('#collapseSafeHHAssessment').collapse('hide');}
        //Check for Validation and Missed Entries for SCHOOLED (HOUSEHOLD ASSESSMENT) Panel
        if(hh_ass_schooled_response_question_10=="" || hh_ass_schooled_response_question_10=="Response"){document.getElementById("hh_ass_schooled_response_question_10_label").innerHTML="Field is required";hh_ass_schooled_response_question_10_chk=0;$('#collapseSchooledHHAssessment').collapse('show');}else{hh_ass_schooled_response_question_10_chk=1;document.getElementById("hh_ass_schooled_response_question_10_label").innerHTML="";$('#collapseSchooledHHAssessment').collapse('hide');}
        //Check for Validation and Missed Entries for SCHOOLED (HOUSEHOLD ASSESSMENT) Panel
        if(hh_ass_stable_response_question_12=="" || hh_ass_stable_response_question_12=="Response"){document.getElementById("hh_ass_stable_response_question_12_label").innerHTML="Field is required";hh_ass_stable_response_question_12_chk=0;$('#collapseStableHHAssessment').collapse('show');}else{hh_ass_stable_response_question_12_chk=1;document.getElementById("hh_ass_stable_response_question_12_label").innerHTML="";$('#collapseStableHHAssessment').collapse('hide');}
        if(hh_ass_stable_response_question_13=="" || hh_ass_stable_response_question_13=="Response"){document.getElementById("hh_ass_stable_response_question_13_label").innerHTML="Field is required";hh_ass_stable_response_question_13_chk=0;$('#collapseStableHHAssessment').collapse('show');}else{hh_ass_stable_response_question_13_chk=1;document.getElementById("hh_ass_stable_response_question_13_label").innerHTML="";$('#collapseStableHHAssessment').collapse('hide');}

        //Check for Validation and Missed Entries for OTHER INFORMATION Panel
        if(accessedby==""){document.getElementById("accessedby_label").innerHTML="Field is required";accessedby_chk=0;$('#collapseOtherInfoHHAssessment').collapse('show');}else{accessedby_chk=1;document.getElementById("accessedby_label").innerHTML="";$('#collapseOtherInfoHHAssessment').collapse('hide');}
        if(reviewedby==""){document.getElementById("reviewedby_label").innerHTML="Field is required";reviewedby_chk=0;$('#collapseOtherInfoHHAssessment').collapse('show');}else{reviewedby_chk=1;document.getElementById("reviewedby_label").innerHTML="";$('#collapseOtherInfoHHAssessment').collapse('hide');}
        if(date_accessed==""){document.getElementById("date_accessed_label").innerHTML="Field is required";date_accessed_chk=0;$('#collapseOtherInfoHHAssessment').collapse('show');}else{date_accessed_chk=1;document.getElementById("date_accessed_label").innerHTML="";$('#collapseOtherInfoHHAssessment').collapse('hide');}
        if(reviewdate==""){document.getElementById("reviewdate_label").innerHTML="Field is required";reviewdate_chk=0;$('#collapseOtherInfoHHAssessment').collapse('show');}else{reviewdate_chk=1;document.getElementById("reviewdate_label").innerHTML="";$('#collapseOtherInfoHHAssessment').collapse('hide');}
        
        //Check for Validation For HIV Status Section
        if(hiv_status=="Positive" && datehivstatus==""){document.getElementById("datehivstatus_label").innerHTML="Field is required";datehivstatus_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{datehivstatus_chk=1;document.getElementById("datehivstatus_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(hiv_status=="Positive" && enrolledontreatment==""){document.getElementById("enrolledontreatment_label").innerHTML="Field is required";enrolledontreatment_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{enrolledontreatment_chk=1;document.getElementById("enrolledontreatment_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(enrolledontreatment=="Yes" && artstartdate==""){document.getElementById("artstartdate_label").innerHTML="Field is required";artstartdate_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{artstartdate_chk=1;document.getElementById("artstartdate_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(enrolledontreatment=="Yes" && facilityenrolled==""){document.getElementById("facilityenrolled_label").innerHTML="Field is required";facilityenrolled_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{facilityenrolled_chk=1;document.getElementById("facilityenrolled_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        if(enrolledontreatment=="Yes" && treatment_art_no==""){document.getElementById("treatment_art_no_label").innerHTML="Field is required";treatment_art_no_chk=0;$('#collapseprimaryCaregiverInformation').collapse('show');}else{treatment_art_no_chk=1;document.getElementById("treatment_art_no_label").innerHTML="";$('#collapseprimaryCaregiverInformation').collapse('hide');}
        

//Confirm validation and set validation status
    if(cbo_code_chk == 0 || date_of_assessment_chk == 0 || state_chk == 0 || lga_chk == 0 || ward_chk == 0 || community_chk == 0
         || datehivstatus_chk == 0 || enrolledontreatment_chk == 0 || artstartdate_chk == 0 || facilityenrolled_chk == 0 || treatment_art_no_chk == 0
        || hh_unique_num_chk == 0 || address_chk == 0 || hh_num_children_chk == 0 || hh_num_people_chk == 0 || surname_chk == 0 || firstname_chk == 0
        || gender_chk == 0 || dob_chk == 0 || phonenumber_chk == 0 || marital_status_chk == 0 || occupation_chk == 0 || hiv_status_chk == 0
        || hh_ass_healthy_response_question_1_chk == 0 || hh_ass_healthy_response_question_2_chk == 0 || hh_ass_healthy_response_question_3_chk == 0 || hh_ass_healthy_response_question_4_chk == 0 || hh_ass_healthy_response_question_5_chk == 0 || hh_ass_healthy_response_question_6_chk == 0
        || hh_ass_safe_response_question_7_chk == 0 || hh_ass_safe_response_question_8_chk == 0 || hh_ass_safe_response_question_9_chk == 0 || hh_ass_schooled_response_question_10_chk == 0 || hh_ass_stable_response_question_12_chk == 0 || hh_ass_stable_response_question_13_chk == 0
        || accessedby_chk == 0 || reviewedby_chk == 0 || date_accessed_chk == 0 || reviewdate_chk == 0){
        validation_state = 'failed';
        Toastify({
            text: "Validation Failed. Review form elements",
            style: {
              background: "linear-gradient(to right, #DC3545, #DC3545)",
            },
            close: true,
            duration: 10000
        }).showToast();
    }
    else{
        createHouseHoldVulnerabilityAssessmentRecord();
    }
}

function createHouseHoldVulnerabilityAssessmentRecord(){

    $.ajax({
        url: 'db/createHouseHoldVulnerabilityAssessmentRecord.php',
        type: 'post',
        data: "cbo_code="+cbo_code+"&date_of_assessment="+date_of_assessment+"&state="+state+"&lga="+lga+"&ward="+ward+"&community="+community+"&addon="+addon
        +"&hh_unique_num="+hh_unique_num+"&address="+address+"&hh_num_children="+hh_num_children+"&hh_num_people="+hh_num_people+"&surname="+surname+"&firstname="+firstname
        +"&gender="+gender+"&dob="+dob+"&phonenumber="+phonenumber+"&marital_status="+marital_status+"&occupation="+occupation+"&hiv_status="+hiv_status
        +"&hh_ass_healthy_response_question_1="+hh_ass_healthy_response_question_1+"&hh_ass_healthy_response_question_2="+hh_ass_healthy_response_question_2+"&hh_ass_healthy_response_question_3="+hh_ass_healthy_response_question_3+"&hh_ass_healthy_response_question_6="+hh_ass_healthy_response_question_6+"&hh_ass_healthy_response_question_5="+hh_ass_healthy_response_question_5+"&hh_ass_healthy_response_question_4="+hh_ass_healthy_response_question_4
        +"&hh_ass_stable_response_question_13="+hh_ass_stable_response_question_13+"&hh_ass_stable_response_question_12="+hh_ass_stable_response_question_12+"&hh_ass_schooled_response_question_10="+hh_ass_schooled_response_question_10+"&hh_ass_safe_response_question_9="+hh_ass_safe_response_question_9+"&hh_ass_safe_response_question_8="+hh_ass_safe_response_question_8+"&hh_ass_safe_response_question_7="+hh_ass_safe_response_question_7
        +"&accessedby="+accessedby+"&reviewedby="+reviewedby+"&date_accessed="+date_accessed+"&reviewdate="+reviewdate+"&total_na="+total_na+"&total_no="+total_no+"&total_yes="+total_yes+"&hh_ass_healthy_comment_question_1="+hh_ass_healthy_comment_question_1
        +"&hh_ass_healthy_comment_question_2="+hh_ass_healthy_comment_question_2
        +"&hh_ass_healthy_comment_question_3="+hh_ass_healthy_comment_question_3
        +"&hh_ass_healthy_comment_question_4="+hh_ass_healthy_comment_question_4
        +"&hh_ass_healthy_comment_question_5="+hh_ass_healthy_comment_question_5
        +"&hh_ass_healthy_comment_question_6="+hh_ass_healthy_comment_question_6
        +"&hh_ass_safe_comment_question_7="+hh_ass_safe_comment_question_7
        +"&hh_ass_safe_comment_question_8="+hh_ass_safe_comment_question_8
        +"&hh_ass_safe_comment_question_9="+hh_ass_safe_comment_question_9
        +"&hh_ass_schooled_comment_question_10="+hh_ass_schooled_comment_question_10
        +"&hh_ass_stable_comment_question_12="+hh_ass_stable_comment_question_12
        +"&hh_ass_stable_comment_question_13="+hh_ass_stable_comment_question_13
        +"&treatment_art_no="+treatment_art_no
        +"&facilityenrolled="+facilityenrolled
        +"&artstartdate="+artstartdate
        +"&enrolledontreatment="+enrolledontreatment
        +"&datehivstatus="+datehivstatus,  
        dataType: 'json',
        success: function(response){ 
          if(response.status=="success"){
            Toastify({
                text: "New Household Vulnerability Assessment Created",
                style: {
                  background: "linear-gradient(to right, #DC3545, #866EC7)",
                },
                close: true,
                duration: 10000
                }).showToast();
                entryForm.reset();
            }
            else if(response.status=="failure"){
                Toastify({
                    text: "Error: Assessment Not Created, Review Entry",
                    style: {
                      background: "linear-gradient(to right, #DC3545, #DC3545)",
                    },
                    close: true,
                    duration: 10000
                }).showToast();        
            }
            else if(response.status=="exists"){
                Toastify({
                    text: "Error: Household Unique ID already exists, Please review",
                    style: {
                      background: "linear-gradient(to right, #DC3545, #DC3545)",
                    },
                    close: true,
                    duration: 10000
                }).showToast();        
            }
            },
    error: function(XMLHttpRequest, textStatus, errorThrown) { 
        alert("Status: " + textStatus); alert("Error: " + errorThrown+XMLHttpRequest); 
    }  	
  })
}


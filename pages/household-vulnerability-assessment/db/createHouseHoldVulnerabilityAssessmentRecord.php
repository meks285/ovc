<?php
require_once("../../../controllers/db/dbHandler.php");

##SET Variables
$cbo_code=$_POST['cbo_code'];
$date_of_assessment = $_POST['date_of_assessment'];
$state = $_POST['state'];
$lga = $_POST['lga'];
$ward = $_POST['ward'];
$community = $_POST['community'];
$addon = $_POST['addon'];
$unique_number = $_POST['hh_unique_num'];
$hh_unique_num = strtoupper($addon).$unique_number;
$address = $_POST['address'];
$hh_num_children = $_POST['hh_num_children'];
$hh_num_people = $_POST['hh_num_people'];
$surname = $_POST['surname'];
$firstname = $_POST['firstname'];
$gender = $_POST['gender'];
$dob = $_POST['dob'];
$phonenumber = $_POST['phonenumber'];
$marital_status = $_POST['marital_status'];
$occupation = $_POST['occupation'];
$hiv_status = $_POST['hiv_status'];
$hh_ass_healthy_response_question_1 = $_POST['hh_ass_healthy_response_question_1'];
$hh_ass_healthy_response_question_2 = $_POST['hh_ass_healthy_response_question_2'];
$hh_ass_healthy_response_question_3 = $_POST['hh_ass_healthy_response_question_3'];
$hh_ass_healthy_response_question_4 = $_POST['hh_ass_healthy_response_question_4'];
$hh_ass_healthy_response_question_5 = $_POST['hh_ass_healthy_response_question_5'];
$hh_ass_healthy_response_question_6 = $_POST['hh_ass_healthy_response_question_6'];
$hh_ass_safe_response_question_7 = $_POST['hh_ass_safe_response_question_7'];
$hh_ass_safe_response_question_8 = $_POST['hh_ass_safe_response_question_8'];
$hh_ass_safe_response_question_9 = $_POST['hh_ass_safe_response_question_9'];
$hh_ass_schooled_response_question_10 = $_POST['hh_ass_schooled_response_question_10'];
$hh_ass_stable_response_question_12 = $_POST['hh_ass_stable_response_question_12'];
$hh_ass_stable_response_question_13 = $_POST['hh_ass_stable_response_question_13'];
##RESPONSE
$hh_ass_healthy_comment_question_1 = $_POST['hh_ass_healthy_comment_question_1'];
$hh_ass_healthy_comment_question_2 = $_POST['hh_ass_healthy_comment_question_2'];
$hh_ass_healthy_comment_question_3 = $_POST['hh_ass_healthy_comment_question_3'];
$hh_ass_healthy_comment_question_4 = $_POST['hh_ass_healthy_comment_question_4'];
$hh_ass_healthy_comment_question_5 = $_POST['hh_ass_healthy_comment_question_5'];
$hh_ass_healthy_comment_question_6 = $_POST['hh_ass_healthy_comment_question_6'];
$hh_ass_safe_comment_question_7 = $_POST['hh_ass_safe_comment_question_7'];
$hh_ass_safe_comment_question_8 = $_POST['hh_ass_safe_comment_question_8'];
$hh_ass_safe_comment_question_9 = $_POST['hh_ass_safe_comment_question_9'];
$hh_ass_schooled_comment_question_10 = $_POST['hh_ass_schooled_comment_question_10'];
$hh_ass_stable_comment_question_12 = $_POST['hh_ass_stable_comment_question_12'];
$hh_ass_stable_comment_question_13 = $_POST['hh_ass_stable_comment_question_13'];

$accessedby = $_POST['accessedby'];
$reviewedby = $_POST['reviewedby'];
$date_accessed = $_POST['date_accessed'];
$reviewdate = $_POST['reviewdate'];
$total_yes = $_POST['total_yes'];
$total_no  = $_POST['total_no'];
$total_na  = $_POST['total_na'];
##HIV STATUS
$treatment_art_no = $_POST['treatment_art_no'];
$facilityenrolled = $_POST['facilityenrolled'];
$artstartdate = $_POST['artstartdate'];
$enrolledontreatment = $_POST['enrolledontreatment'];
$datehivstatus = $_POST['datehivstatus'];

if($conn_status=="success"){
        ## Check if CBO has been registered
        $stmt = $conn->prepare("SELECT id from hh_vulnerability_assessment where cbo_code='$cbo_code' AND unique_number='$unique_number'");
        $stmt->execute();
        $recordsSelected = $stmt->rowCount();
        if($recordsSelected == 0){
            $stmt = $conn->prepare("INSERT INTO `hh_vulnerability_assessment` (
              `cbo_code`,
              `date_of_assessment`,
              `state`,
              `lga`,
              `ward`,
              `community`,
              `unique_number`,
              `hh_unique_num`,
              `address`,
              `hh_num_children`,
              `hh_num_people`,
              `surname`,
              `firstname`,
              `gender`,
              `dob`,
              `phonenumber`,
              `marital_status`,
              `occupation`,
              `hiv_status`,
              `treatment_art_no`,
              `facilityenrolled`,
              `artstartdate`,
              `enrolledontreatment`,
              `datehivstatus`,
              `hh_ass_healthy_response_question_1`,
              `hh_ass_healthy_comment_question_1`,
              `hh_ass_healthy_response_question_2`,
              `hh_ass_healthy_comment_question_2`,
              `hh_ass_healthy_response_question_3`,
              `hh_ass_healthy_comment_question_3`,
              `hh_ass_healthy_response_question_4`,
              `hh_ass_healthy_comment_question_4`,
              `hh_ass_healthy_response_question_5`,
              `hh_ass_healthy_comment_question_5`,
              `hh_ass_healthy_response_question_6`,
              `hh_ass_healthy_comment_question_6`,
              `hh_ass_safe_response_question_7`,
              `hh_ass_safe_comment_question_7`,
              `hh_ass_safe_response_question_8`,
              `hh_ass_safe_comment_question_8`,
              `hh_ass_safe_response_question_9`,
              `hh_ass_safe_comment_question_9`,
              `hh_ass_schooled_response_question_10`,
              `hh_ass_schooled_comment_question_10`,
              `hh_ass_stable_response_question_12`,
              `hh_ass_stable_comment_question_12`,
              `hh_ass_stable_response_question_13`,
              `hh_ass_stable_comment_question_13`,
              `reviewedby`,
              `accessedby`,
              `date_accessed`,
              `reviewdate`,
              `total_yes`,
              `total_no`,
              `total_na`
            ) 
            VALUES
              (
                '$cbo_code',
                '$date_of_assessment',
                '$state',
                '$lga',
                '$ward',
                '$community',
                '$unique_number',
                '$hh_unique_num',
                '$address',
                '$hh_num_children',
                '$hh_num_people',
                '$surname',
                '$firstname',
                '$gender',
                '$dob',
                '$phonenumber',
                '$marital_status',
                '$occupation',
                '$hiv_status',
                '$treatment_art_no',
                '$facilityenrolled',
                '$artstartdate',
                '$enrolledontreatment',
                '$datehivstatus',
                '$hh_ass_healthy_response_question_1',
                '$hh_ass_healthy_comment_question_1',
                '$hh_ass_healthy_response_question_2',
                '$hh_ass_healthy_comment_question_2',
                '$hh_ass_healthy_response_question_3',
                '$hh_ass_healthy_comment_question_3',
                '$hh_ass_healthy_response_question_4',
                '$hh_ass_healthy_comment_question_4',
                '$hh_ass_healthy_response_question_5',
                '$hh_ass_healthy_comment_question_5',
                '$hh_ass_healthy_response_question_6',
                '$hh_ass_healthy_comment_question_6',
                '$hh_ass_safe_response_question_7',
                '$hh_ass_safe_comment_question_7',
                '$hh_ass_safe_response_question_8',
                '$hh_ass_safe_comment_question_8',
                '$hh_ass_safe_response_question_9',
                '$hh_ass_safe_comment_question_9',
                '$hh_ass_schooled_response_question_10',
                '$hh_ass_schooled_comment_question_10',
                '$hh_ass_stable_response_question_12',
                '$hh_ass_stable_comment_question_12',
                '$hh_ass_stable_response_question_13',
                '$hh_ass_stable_comment_question_13',
                '$reviewedby',
                '$accessedby',
                '$date_accessed',
                '$reviewdate',
                '$total_yes',
                '$total_no',
                '$total_na'
              )");
            $stmt->execute();
            $recordsinserted = $stmt->rowCount();
            if($recordsinserted >= 1){
              die(json_encode(['status' => 'success']));
            }
            else{
                die(json_encode(['status' => 'failure']));
            }        
        }
        else{
            die(json_encode(['status' => 'exists']));
        }        


}
else{
    die(json_encode(['status' => 'connect_fail']));
}
?>